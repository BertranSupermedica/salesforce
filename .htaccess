# Redirect all requests to public directory
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Redirect to public folder if not already there
    RewriteCond %{REQUEST_URI} !^/public/
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ public/$1 [L,QSA]
    
    # If accessing public directly, rewrite to remove public from URL
    RewriteCond %{THE_REQUEST} /public/([^\s?]*) [NC]
    RewriteRule ^ /%1 [R=301,L]
    
    # Handle public directory requests
    RewriteRule ^(.*) public/$1 [L]
</IfModule>

# Security - Prevent access to sensitive files in root
<Files ".env">
    Order allow,deny
    Deny from all
</Files>

<Files "composer.json">
    Order allow,deny
    Deny from all
</Files>

<Files "composer.lock">
    Order allow,deny
    Deny from all
</Files>

<FilesMatch "\.(log|sh|inc|bak|sql)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Prevent directory browsing
Options -Indexes